% Purpose of this file: to read input files, then truncate the file by the user specified lenghth, 
% and resample the signal according to the sampling frequency of the RIR

computed_rir = load('Computed_RIRs.mat'); % always call this before you start, because you need the sampling frequency of the RIR

% User defined variables
lenMicSig = 5; % length of desired microphone signal in seconds
fs_source = [0 0 0 0];
numOfMicsGUI = size(RIR_sources,2);
numOfSourcesGUI = size(RIR_sources,3);
numOfNoiseSourcesGUI = length(v_pos);
numInputSource = 1; 
numInputNoise = 1;

source_speech = cell(numInputSource);
source_noise = cell(numInputNoise);

[source_speech{1,1},source_speech{1,2}] = audioread('speech1.wav');
% [source_speech{2,1},source_speech{2,2}] = audioread('speech2.wav');
[source_noise{1,1},source_noise{1,2}] = audioread('Babble_noise1.wav');
% [source_noise{2,1},source_noise{2,2}] = audioread('White_noise1.wav');


samplesToKeep = fs_RIR.*lenMicSig;
for i = 1:numInputSource
	source_speech{i,1} = resample(source_speech{i,1},computed_rir.fs_RIR,source_speech{i,2});
	source_speech{i,1} = source_speech{i,1}(1:samplesToKeep);
end

for i = 1:numInputNoise
	source_noise{i,1} = resample(source_noise{i,1},computed_rir.fs_RIR,source_noise{i,2});
	source_noise{i,1} = source_noise{i,1}(1:samplesToKeep);
end



for i = 1:numOfMicsGUI
	tempSource = [];
	for j = 1:numOfSourcesGUI % Sum up the number of conv()
		tempSource = tempSource + conv(source_speech{j,1}, RIR_sources(:,i,j));
	end
	tempNoise = [];
	for k = 1:numOfNoiseSourcesGUI
		tempNoise = tempNoise + conv(source_noise{k,1}, RIR_noise(:,i,k));
	end
	mic(:,i) = tempSource + tempNoise;
	
	
	
end



save('mic','mic','fs_RIR')

figure % to plot the two mic signals
hold on
plot(mic(:,1))
plot(mic(:,2))
hold off



